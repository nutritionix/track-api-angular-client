/**
 * @license Track Api Angular Client
 * @version 1.7.0
 * (c) 2016 Nutritionix, LLC. http://nutritinix.com
 * License: MIT
 */
!function(t,e,n){"use strict";var r=e.module("nix.track-api-client",[]);r.provider("nixTrackApiClient",function(){var t,a,i="https://trackapi.nutritionix.com/v2",o=i,u={},s={};this.setApiEndpoint=function(t){o=t},t=this.setApiCredentials=function(t,e){u.appId=t,u.appKey=e},a=this.setHttpConfig=function(t,n){e.isObject(t)&&(s=n?e.merge(s,t):t)},this.$get=["$http","nixTrackUtils",function(c,d){var l,f=function(t,e){return e=r.deepMerge({method:"GET",url:o+t,headers:{"Content-Type":"application/json","x-user-jwt":f.getUserJwt(),"X-APP-ID":u.appId,"X-APP-KEY":u.appKey},params:{}},s,e),c(e)};return f.getApiEndpoint=function(t){return t?i:o},f.getUserJwt=function(){return e.isFunction(l)?l():l},f.setUserJwt=function(t){l=t},f.setApiCredentials=t,f.setHttpConfig=a,f.calories_nutrient=208,f.macronutrients=[204,606,205,291,269,203],f.natural={},f.natural.nutrients=function(t,r){return f("/natural/nutrients",{method:"POST",data:e.isString(t)?{query:t}:t,headers:r?{"x-user-jwt":n}:{}})},f.natural.tags=function(t){return f("/natural/tags",{method:"POST",data:{query:t}})},f.natural.add=function(t){return f("/natural/add",{method:"POST",data:e.isObject(t)?t:{query:t}})},f.natural.update=function(t,e){return f("/natural/update",{method:"PUT",data:{query:t,foods:e}})},f.log={},f.log.get=function(t,n){return e.isObject(t)&&(n=t,t=""),e.isObject(n)||(n={}),n.userId&&(t=n.userId),f("/log"+(t?"/"+t:""),{method:"GET",params:n})},f.log["delete"]=function(t){return f("/log",{method:"DELETE",data:{foods:e.isArray(t)?t:[t]}})},f.log.add=function(t){return f("/log",{method:"POST",data:{foods:d.cleanFoods(e.isArray(t)?t:[t])}})},f.log.copy=function(t,e){var n=d.copyFood(t);return n.consumed_at=e,f.log.add(n)},f.log.barcode=function(t,e){var n={upc:t};return e&&(n.consumed_at=e),f("/log/barcode",{method:"POST",data:n})},f.log.update=function(t){return f("/log",{method:"PUT",data:{foods:d.cleanFoods(e.isArray(t)?t:[t])}})},f.oauth={facebook:{},fitbit:{}},f.oauth.facebook.i=function(t,e){return f("/oauth/facebook/i",{method:"POST",data:{access_token:t,ref_code:e}})},f.oauth.fitbit.sign=function(){return f("/oauth/fitbit/sign",{method:"POST",data:{}})},f.oauth.fitbit.unlink=function(t){return f("/oauth/fitbit/unlink",{})},f.users=function(){return f("/users",{method:"GET"})},f.users.preferences=function(t){return f("/users/preferences",{method:"POST",data:{users:e.isArray(t)?t:[t]}})},f.me=function(){return f("/me",{method:"GET"})},f.me.preferences=function(t){return f("/me/preferences",{method:"PUT",data:t})},f.auth={signup:{},updatePassword:{}},f.auth.signup.step1=function(t){return f("/auth/signup/step1",{method:"POST",data:t})},f.auth.signup.step2=function(t){return f("/auth/signup/step2",{method:"POST",data:t})},f.auth.signin=function(t){return f("/auth/signin",{method:"POST",data:t})},f.auth.updatePassword.request=function(t){var e={};return t.indexOf("@")?e.email=t:e.mobile_number=t,f("/auth/updatePassword",{method:"GET",params:e})},f.auth.updatePassword.set=function(t){return f("/auth/updatePassword",{method:"POST",data:t})},f.permissions={},f.permissions.request=function(t){return f("/premissions/request",{method:"POST",data:{users:e.isArray(t)?t:[t]}})},f.reports={},f.reports.totals=function(t){return f("/reports/totals",{method:"GET",params:t})},f.reports.suggested=function(){return f("/reports/suggested",{method:"GET"})},f.reports.summary=function(t){return f("/reports/summary",{method:"GET",params:t?{timezone:t}:{}})},f.recipes={},f.recipes.get=function(t){return f("/recipes"+(t?"/"+t:""),{method:"GET"})},f.recipes.add=function(t){return f("/recipes",{method:"POST",data:{recipe:t}})},f.recipes.update=function(t){return f("/recipes",{method:"PUT",data:{recipe:t}})},f.recipes["delete"]=function(t){return f("/recipes/"+t,{method:"DELETE"})},f}]}),r.factory("nixTrackCalculator",function(){return{exerciseLevels:[{title:"Little to no exercise",factor:1.2},{title:"Light exercise (1-3 days per week)",factor:1.375},{title:"Moderate exercise (3-5 days per week)",factor:1.55},{title:"Heavy exercise (6-7 days per week)",factor:1.725},{title:"Very heavy exercise (twice per day, extra heavy workouts)",factor:1.9}],calculateBmr:function(t,e,n,r){return"f"===(t||"").toString().toLowerCase()[0]?447.593+9.247*e+3.098*n-4.33*r:88.362+13.397*e+4.799*n-5.677*r},calculateRecommendedCalories:function(t,e,n,r,a){return a=parseInt(a),(!a||a<0||a>4)&&(a=0),Math.round(this.exerciseLevels[a].factor*this.calculateBmr(t,e,n,r))}}}),r.factory("nixTrackUtils",["$filter",function(t){function n(t){return!isNaN(parseFloat(t))&&isFinite(t)}return{foodAllowedFields:["metadata","food_name","brand_name","serving_qty","serving_unit","serving_weight_grams","nf_calories","nf_total_fat","nf_saturated_fat","nf_cholesterol","nf_sodium","nf_total_carbohydrate","nf_dietary_fiber","nf_sugars","nf_protein","nf_potassium","nf_p","full_nutrients","created_at","consumed_at","nix_brand_name","nix_brand_id","nix_item_name","nix_item_id","upc","source","ndb_no","natural_query_id","tags","id","alt_measures","photo","meal_type","note","nf_ingredient_statement"],isNumeric:n,multiplyFoodNutrients:function(t,r,a){var i=a?t:this.copyFood(t);return r=this.convertSimpleFractionToDecimal(r||1),1===+r?i:(e.forEach(i,function(t,e){!n(i[e])||"serving_qty"!==e&&"serving_weight_grams"!==e&&"nf_"!==e.substr(0,3)||(i[e]*=r)}),e.isArray(i.full_nutrients)||(i.full_nutrients=[]),e.forEach(i.full_nutrients,function(t){t.value*=r}),i)},sumFoods:function(r){var a={serving_qty:1,serving_unit:"Serving",full_nutrients:[],nf_ingredient_statement:r.map(function(t){return t.nf_ingredient_statement||""}).filter(function(t){return!!t}).join("\n").trim()||null};return e.forEach(r,function(r){e.forEach(r,function(t,e){n(t)&&("serving_weight_grams"===e||"nf_ingredient_statement"!==e&&"nf_"===e.substr(0,3))&&(a[e]=(a[e]||0)+parseFloat(t))}),e.forEach(r.full_nutrients,function(n){var r=t("nutrient")(a.full_nutrients,n.attr_id);r?null===r.value&&null===n.value||(r.value=parseFloat(r.value||0)+parseFloat(n.value||0)):a.full_nutrients.push(e.copy(n))})}),a},calculateFoodMultiplier:function(t,e){return this.convertSimpleFractionToDecimal(e)/t.serving_qty},copyFood:function(t){var n=e.copy(t);return delete n.id,delete n.created_at,delete n.consumed_at,delete n.meal_type,n},convertSimpleFractionToDecimal:function(t){var e=/^(\d+)\/(\d+)$/.exec(t);return e&&(t=e[1]/e[2]),t},cleanFoods:function(t){var n,r,a,i,o,u;for(e.isArray(t)?n=[]:t=[t],a=0;a<t.length;a+=1){for(u=t[a],r={},i=0;i<this.foodAllowedFields.length;i+=1)o=this.foodAllowedFields[i],o in u&&(r[o]=u[o],"note"!==o||r[o]||(r[o]=null));e.isArray(n)?n.push(r):n=r}return n}}}]),r.filter("nutrient",function(){return function(t,n,r){var a;if(n=parseInt(n),n&&e.isArray(t))for(a in t)if(t.hasOwnProperty(a)&&parseInt(t[a].attr_id)===n)return r?t[a][r]:t[a];return null}}),r.deepMerge=function a(t,n){var r,i;if(arguments.length>2)return a(t,a.apply(null,Array.prototype.slice.call(arguments,1)));r=e.copy(t);for(i in n)n.hasOwnProperty(i)&&(r.hasOwnProperty(i)&&e.isObject(r[i])&&e.isObject(n[i])?r[i]=a(r[i],n[i]):r[i]=e.copy(n[i]));return r}}(window,window.angular);