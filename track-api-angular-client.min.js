/**
 * @license Track Api Angular Client
 * @version 1.3.1
 * (c) 2016 Nutritionix, LLC. http://nutritinix.com
 * License: MIT
 */
!function(t,e,r){"use strict";var n=e.module("nix.track-api-client",[]);n.provider("nixTrackApiClient",function(){var t,r="https://trackapi.nutritionix.com/v1",a=r,i={},o={};this.setApiEndpoint=function(t){a=t},t=this.setApiCredentials=function(t,e){i.appId=t,i.appKey=e},this.setHttpConfig=function(t){e.isObject(t)&&(o=t)},this.$get=["$http","nixTrackUtils",function(u,s){var c,d=function(t,e){return e=n.deepMerge({method:"GET",url:a+t,headers:{"Content-Type":"application/json","x-user-jwt":d.getUserJwt(),"X-APP-ID":i.appId,"X-APP-KEY":i.appKey},params:{}},o,e),u(e)};return d.getApiEndpoint=function(t){return t?r:a},d.getUserJwt=function(){return e.isFunction(c)?c():c},d.setUserJwt=function(t){c=t},d.setApiCredentials=t,d.calories_nutrient=208,d.macronutrients=[204,606,205,291,269,203],d.natural={},d.natural.nutrients=function(t){return d("/natural/nutrients",{method:"POST",data:e.isString(t)?{query:t}:t})},d.natural.tags=function(t){return d("/natural/tags",{method:"POST",data:{query:t}})},d.natural.add=function(t){return d("/natural/add",{method:"POST",data:e.isObject(t)?t:{query:t}})},d.natural.update=function(t,e){return d("/natural/update",{method:"PUT",data:{query:t,foods:e}})},d.log={},d.log.get=function(t,r){return e.isObject(t)&&(r=t,t=""),e.isObject(r)||(r={}),r.userId&&(t=r.userId),d("/log"+(t?"/"+t:""),{method:"GET",params:r})},d.log["delete"]=function(t){return d("/log",{method:"DELETE",data:{foods:e.isArray(t)?t:[t]}})},d.log.add=function(t){return d("/log",{method:"POST",data:{foods:s.cleanFoods(e.isArray(t)?t:[t])}})},d.log.copy=function(t,e){var r=s.copyFood(t);return r.consumed_at=e,d.log.add(r)},d.log.barcode=function(t,e){var r={upc:t};return e&&(r.consumed_at=e),d("/log/barcode",{method:"POST",data:r})},d.log.update=function(t){return d("/log",{method:"PUT",data:{foods:s.cleanFoods(e.isArray(t)?t:[t])}})},d.oauth={facebook:{},fitbit:{}},d.oauth.facebook.i=function(t,e){return d("/oauth/facebook/i",{method:"POST",data:{access_token:t,ref_code:e}})},d.oauth.fitbit.sign=function(){return d("/oauth/fitbit/sign",{method:"POST",data:{}})},d.oauth.fitbit.unlink=function(t){return d("/oauth/fitbit/unlink",{})},d.users=function(){return d("/users",{method:"GET"})},d.users.preferences=function(t){return d("/users/preferences",{method:"POST",data:{users:e.isArray(t)?t:[t]}})},d.me=function(){return d("/me",{method:"GET"})},d.me.preferences=function(t){return d("/me/preferences",{method:"PUT",data:t})},d.auth={signup:{},updatePassword:{}},d.auth.signup.step1=function(t){return d("/auth/signup/step1",{method:"POST",data:t})},d.auth.signup.step2=function(t){return d("/auth/signup/step2",{method:"POST",data:t})},d.auth.signin=function(t){return d("/auth/signin",{method:"POST",data:t})},d.auth.updatePassword.request=function(t){var e={};return t.indexOf("@")?e.email=t:e.mobile_number=t,d("/auth/updatePassword",{method:"GET",params:e})},d.auth.updatePassword.set=function(t){return d("/auth/updatePassword",{method:"POST",data:t})},d.permissions={},d.permissions.request=function(t){return d("/premissions/request",{method:"POST",data:{users:e.isArray(t)?t:[t]}})},d.reports={},d.reports.totals=function(t){return d("/reports/totals",{method:"GET",params:t})},d.recipes={},d.recipes["delete"]=function(t){return d("/recipes",{method:"DELETE",data:{id:t}})},d.recipes.get=function(t,e){var r={};return e&&(r.user=e),t&&(r.id=t),d("/recipes",{method:"GET",params:r})},d.recipes.add=function(t,e){return d("/recipes",{method:"POST",data:{query:e,recipe_name:t}})},d.recipes.update=function(t,r,n){var a={id:t};return e.isUndefined(r)||(a.name=r),e.isUndefined(n)||(a.query=n),d("/recipes",{method:"PUT",headers:{"x-user-jwt":d.getUserJwt()},data:a})},d}]}),n.factory("nixTrackCalculator",function(){return{exerciseLevels:[{title:"Little to no exercise",factor:1.2},{title:"Light exercise (1-3 days per week)",factor:1.375},{title:"Moderate exercise (3-5 days per week)",factor:1.55},{title:"Heavy exercise (6-7 days per week)",factor:1.725},{title:"Very heavy exercise (twice per day, extra heavy workouts)",factor:1.9}],calculateBmr:function(t,e,r,n){return"f"===(t||"").toString().toLowerCase()[0]?447.593+9.247*e+3.098*r-4.33*n:88.362+13.397*e+4.799*r-5.677*n},calculateRecommendedCalories:function(t,e,r,n,a){return a=parseInt(a),(!a||0>a||a>4)&&(a=0),Math.round(this.exerciseLevels[a].factor*this.calculateBmr(t,e,r,n))}}}),n.factory("nixTrackUtils",["$filter",function(t){return{foodAllowedFields:["metadata","food_name","brand_name","serving_qty","serving_unit","serving_weight_grams","nf_calories","nf_total_fat","nf_saturated_fat","nf_cholesterol","nf_sodium","nf_total_carbohydrate","nf_dietary_fiber","nf_sugars","nf_protein","nf_potassium","nf_p","full_nutrients","created_at","consumed_at","nix_brand_name","nix_brand_id","nix_item_name","nix_item_id","upc","source","ndb_no","natural_query_id","tags","id","alt_measures"],multiplyFoodNutrients:function(t,r,n){var a=n?t:this.copyFood(t);return r=this.convertSimpleFractionToDecimal(r||1),1===+r?a:(e.forEach(a,function(t,e){("serving_qty"===e||"serving_weight_grams"===e||"nf_"===e.substr(0,3))&&(a[e]*=r)}),e.isArray(a.full_nutrients)||(a.full_nutrients=[]),e.forEach(a.full_nutrients,function(t){t.value*=r}),a)},sumFoods:function(r){var n={serving_qty:1,serving_unit:"Serving",full_nutrients:[]};return e.forEach(r,function(r){e.forEach(r,function(t,e){("serving_weight_grams"===e||"nf_"===e.substr(0,3))&&(n[e]=(n[e]||0)+t)}),e.forEach(r.full_nutrients,function(r){var a=t("nutrient")(n.full_nutrients,r.attr_id);a?a.value+=r.value:n.full_nutrients.push(e.copy(r))})}),n},calculateFoodMultiplier:function(t,e){return this.convertSimpleFractionToDecimal(e)/t.serving_qty},copyFood:function(t){var r=e.copy(t);return delete r.id,delete r.created_at,delete r.consumed_at,r},convertSimpleFractionToDecimal:function(t){var e=/^(\d+)\/(\d+)$/.exec(t);return e&&(t=e[1]/e[2]),t},cleanFoods:function(t){var r,n,a,i,o,u;for(e.isArray(t)?r=[]:t=[t],a=0;a<t.length;a+=1){for(u=t[a],n={},i=0;i<this.foodAllowedFields.length;i+=1)o=this.foodAllowedFields[i],o in u&&(n[o]=u[o]);e.isArray(r)?r.push(n):r=n}return r}}}]),n.filter("nutrient",function(){return function(t,r,n){var a;if(r=parseInt(r),r&&e.isArray(t))for(a in t)if(t.hasOwnProperty(a)&&parseInt(t[a].attr_id)===r)return n?t[a][n]:t[a];return null}}),n.deepMerge=function a(t,r){var n,i;if(arguments.length>2)return a(t,a.apply(null,Array.prototype.slice.call(arguments,1)));n=e.copy(t);for(i in r)r.hasOwnProperty(i)&&(n.hasOwnProperty(i)&&e.isObject(n[i])&&e.isObject(r[i])?n[i]=a(n[i],r[i]):n[i]=e.copy(r[i]));return n}}(window,window.angular);